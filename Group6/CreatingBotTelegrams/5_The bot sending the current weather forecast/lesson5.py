from bot_token import TOKEN
import requests

lat, lon = 45, 39

weathers = {
    '—è—Å–Ω–æ': '‚òÄÔ∏è',
    '–ø–∞—Å–º—É—Ä–Ω–æ': '‚òÅÔ∏è',
    '–¥–æ–∂–¥—å': 'üåßÔ∏è',
    '—Å–Ω–µ–≥': 'üå®Ô∏è',
    '–≥—Ä–æ–∑–∞': 'üåßÔ∏è',
    '–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å': '‚õÖÔ∏è',
    '–æ–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏': '‚õÖÔ∏è',
    '–Ω–µ–±–æ–ª—å—à–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å': '‚õÖÔ∏è',
    '–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å': '‚õÖÔ∏è',
    '–ø–∞—Å–º—É—Ä–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏': 'üåßÔ∏è',
    '–ø–∞—Å–º—É—Ä–Ω–æ —Å –≥—Ä–æ–∑–æ–π': 'üåßÔ∏è',
    '–Ω–µ–±–æ–ª—å—à–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å': '‚õÖÔ∏è',
    '–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å': '‚õÖÔ∏è',
    '–Ω–µ–±–æ–ª—å—à–æ–∏ÃÜ –¥–æ–∂–¥—å': 'üåßÔ∏è',
    '–Ω–µ–±–æ–ª—å—à–æ–∏ÃÜ –¥–æ–∂–¥—å —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏': 'üåßÔ∏è',
    '–Ω–µ–±–æ–ª—å—à–æ–∏ÃÜ –¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π': 'üåßÔ∏è',
    '–¥–æ–∂–¥—å': 'üåßÔ∏è',
    '–¥–æ–∂–¥—å —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏': 'üåßÔ∏è',
    '–¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π –∏ —Å–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π –∏ —Å–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä': 'üåßÔ∏è',
    '—Å–∏–ª—å–Ω—ã–∏ÃÜ –¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π –∏ —Å–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä': 'üåßÔ∏è',
}

weather_codes = {
    0: '–Ø—Å–Ω–æ–µ –Ω–µ–±–æ',
    1: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ',
    2: '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å',
    3: '–ü–∞—Å–º—É—Ä–Ω–æ',
    45: '–¢—É–º–∞–Ω –∏ –Ω–∞–ª–∏–ø–∞—é—â–∏–π –∏–Ω–µ–π',
    48: '–¢—É–º–∞–Ω –∏ –Ω–∞–ª–∏–ø–∞—é—â–∏–π –∏–Ω–µ–π',
    51: '–õ—ë–≥–∫–∞—è –º–æ—Ä–æ—Å—å',
    53: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å',
    55: '–ú–æ—Ä–æ—Å—å: –ø–ª–æ—Ç–Ω–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å',
    56: '–õ—ë–≥–∫–∏–π –º–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å',
    57: '–ú–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏',
    61: '–°–ª–∞–±—ã–π –¥–æ–∂–¥—å',
    63: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å',
    65: '–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å',
    66: '–ù–µ–±–æ–ª—å—à–æ–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å',
    67: '–û–±–∏–ª—å–Ω—ã–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å',
    71: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥–æ–ø–∞–¥: , —É–º–µ—Ä–µ–Ω–Ω—ã–π –∏ –æ–±–∏–ª—å–Ω—ã–π –ø–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏',
    73: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥',
    75: '–û–±–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥',
    77: '–ö—Ä—É–ø–∏–Ω–∫–∏ —Å–Ω–µ–≥–∞',
    80: '–°–ª–∞–±—ã–µ –ª–∏–≤–Ω–∏: , —É–º–µ—Ä–µ–Ω–Ω—ã–µ –∏ —Å–∏–ª—å–Ω—ã–µ',
    81: '–£–º–µ—Ä–µ–Ω–Ω—ã–µ –ª–∏–≤–Ω–∏',
    82: '–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–∏',
    85: '–õ–µ–≥–∫–∏–µ —Å–Ω–µ–≥–æ–ø–∞–¥—ã',
    86: '–°–∏–ª—å–Ω—ã–µ —Å–Ω–µ–≥–æ–ø–∞–¥—ã',
    95: '–ì—Ä–æ–∑–∞',
    96: '–ì—Ä–æ–∑–∞ —Å –Ω–µ–±–æ–ª—å—à–∏–º  –≥—Ä–∞–¥–æ–º',
    99: '–ì—Ä–æ–∑–∞ —Å —Å–∏–ª—å–Ω—ã–º –≥—Ä–∞–¥–æ–º',
}

def get_wind_direction(wind_direction):
    remainder = wind_direction % 45
    correction = 0 if remainder < 22.5 else 1
    wind_dirs = ['–° ‚¨Ü', '–°–í ‚Üó', '–í ‚û°', '–Æ–í ‚Üò', '–Æ ‚¨á', '–Æ–ó ‚Üô', '–ó ‚¨Ö', '–°–ó ‚Üñ']
    wind_dir_index = wind_direction % 360 // 45 + correction
    index = 0 if wind_dir_index == len(wind_dirs) else wind_dir_index
    wind_dir_index = wind_dirs[index]

    return wind_dir_index

def get_url(lat, lon):
    return f'https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,showers,snowfall,wind_speed_10m,wind_direction_10m,wind_gusts_10m&daily=weather_code&wind_speed_unit=ms&timezone=Europe%2FMoscow&forecast_days=1'

def get_weather(lat, lon):
    url = get_url(lat, lon)
    weather = requests.get(url).json()
    WC = weather['current']
    text = ''
    text += f'–¢–∏–ø –ø–æ–≥–æ–¥—ã: {weather_codes[weather["daily"]["weather_code"][0]]}\n'
    text += f'üå°Ô∏è  –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –í–û–ó–î–£–•–ê: {WC["temperature_2m"]}‚ÑÉ\n'
    text += f'üíß –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å: {WC["relative_humidity_2m"]}%\n'
    text += f'–û—â—É—â–∞–µ–º–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {WC["apparent_temperature"]}‚ÑÉ\n'
    if WC['precipitation'] == 0:
        text +='–ù–µ—Ç –æ—Å–∞–¥–∫–æ–≤\n'
    else:
        if WC['rain'] != 0:
            text += f'üåßÔ∏è –î–æ–∂–¥—å: {WC["rain"]} –º–º\n'
        if WC['showers'] != 0:
            text +=f'–õ–∏–≤–µ–Ω—å: {WC["showers"]} –º–º\n'
        if WC['snowfall'] != 0:
            text += f'‚ùÑÔ∏è –°–Ω–µ–≥: {WC["snowfall"]} —Å–º\n'

    text += f'üçÉ –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: {WC["wind_speed_10m"]} –º/—Å\n'
    
    text += f'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞: {get_wind_direction(WC["wind_direction_10m"])}\n'
    text += f'üå™Ô∏è  –ü–æ—Ä—ã–≤—ã –≤–µ—Ç—Ä–∞: {WC['wind_gusts_10m']} –º/—Å\n'

    return text







# print(get_weather(lat, lon))

""" 
print(f'–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {weather["temperature_2m"]}‚ÑÉ')
print(f'–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å: {weather["relative_humidity_2m"]}%')
print(f'–û—â—É—â–∞–µ–º–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {weather["apparent_temperature"]}‚ÑÉ') 
"""
""" 
if weather['precipitation'] == 0:
    print('–ù–µ—Ç –æ—Å–∞–¥–∫–æ–≤')
else:
    if weather['rain'] != 0:
        print(f'–î–æ–∂–¥—å: {weather["rain"]} –º–º')
    if weather['showers'] != 0:
        print(f'–õ–∏–≤–µ–Ω—å: {weather["showers"]} –º–º')
    if weather['snowfall'] != 0:
        print(f'–°–Ω–µ–≥: {weather["snowfall"]} —Å–º')

print(f'–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: {weather["wind_speed_10m"]} –º/—Å')


wind_dirs = ['–°', '–°–í', '–í', '–Æ–í', '–Æ', '–Æ–ó', '–ó', '–°–ó']
wind_dir = wind_dirs[weather['wind_direction_10m'] % 360 // 45]
remainder = weather['wind_direction_10m'] % 45
correction = remainder
print('–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞ 45 - ', weather['wind_direction_10m'] // 45, '–æ—Å—Ç–∞—Ç–æ–∫', remainder)
print(f'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞: {wind_dir}')
print(f'–ü–æ—Ä—ã–≤—ã –≤–µ—Ç—Ä–∞: {weather['wind_gusts_10m']} –º/—Å') 
"""
